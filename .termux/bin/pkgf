#!/usr/bin/env bash

# preview shows info about the package
preview='pkg show {} 2> /dev/null | bat --color=always --pager=never --decorations=never --language=yaml'

selection=$(pkg list-all 2> /dev/null | \
  # remove "Listing..."
  tail --lines +2 | \
  # remove repo name and package status
  sed -r 's#^([^/]+)/.*$#\1#' | \
  # select packages with fzf
  fzf --multi --preview "$preview" --preview-window="$FZF_DEFAULT_PREVIEW_WINDOW_OPTS" | \
  tr '\n' ' '
  )

if [ -n "$selection" ]; then
  cmd="pkg install ${selection}"
   # echo "$cmd"
  print -s "$cmd"
  eval "$cmd"
fi
